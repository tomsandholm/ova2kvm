runcmd:
  - echo '{{ ds.meta_data.role }}' > /etc/role
  - echo '{{ ds.meta_data.aenv }}' > /etc/aenv
  - update-grub
  - apt autoremove -y
  - docker pull jenkins/jenkins:lts-jdk11
  - curl -fsSL https://raw.githubusercontent.com/MatchbookLab/local-persist/master/scripts/install.sh | sudo bash
  - mkdir /opt/docker/jenkins
  - docker volume create -d local-persist -o mountpoint=/opt/docker/jenkins/certs --name=jenkins-certs
  - docker volume create -d local-persist -o mountpoint=/opt/docker/jenkins/data --name=jenkins-data
  - docker run --name jenkins -d -p 8080:8080 -p 50000:50000 --volume jenkins-certs:/certs/client:ro --volume jenkins-data:/var/jenkins_home --restart=on-failure jenkins/jenkins:lts-jdk11 
  - touch /etc/cloud/cloud-init.disabled
  - eject
  - shutdown -h now
